!function(t){var n=t.webkitAudioContext||t.AudioContext;if(!n)throw new Error("No Web Audio API support - cannot initialize Rhombus.");var e={};t.Rhombus=e,e._ctx=new n}(this),function(t){t.Util={},t.Util.noteNum2Freq=function(t){var n=440*Math.pow(2,(t-69)/12);return n}}(this.Rhombus),function(t){function n(n){this._pitch=n,this._osc=t._ctx.createOscillator(),this._oscGain=t._ctx.createGain(),this._filter=t._ctx.createBiquadFilter(),this._filterGain=t._ctx.createGain(),this._osc.type="square",this._oscGain.gain.value=0,this._filter.type="lowpass",this._filter.frequency.value=0,this._osc.connect(this._oscGain),this._oscGain.connect(this._filter),this._filter.connect(this._filterGain),this._filterGain.connect(t._ctx.destination),this._filterGain.gain.value=.5}function e(){this._triggers=new Array}n.prototype={noteOn:function(n){var e=t._ctx.currentTime+n,i=t.Util.noteNum2Freq(this._pitch);this._osc.frequency.setValueAtTime(i,t._ctx.currentTime),this._osc.start(e),this._filter.Q.value=3+9*(1-this._pitch/127),this._oscGain.gain.linearRampToValueAtTime(.6,e+.005),this._oscGain.gain.linearRampToValueAtTime(.4,e+.01),this._filter.frequency.linearRampToValueAtTime(4e3,e+.005),this._filter.frequency.exponentialRampToValueAtTime(200,e+.25)},noteOff:function(n,e){if(e&&e!==this._pitch)return!1;var i=t._ctx.currentTime+.125+n;return this._oscGain.gain.linearRampToValueAtTime(0,i),this._osc.stop(i),!0}},e.prototype={noteOn:function(t,e){if(!(0>t||t>127)){var i=new n(t);i.noteOn(e),this._triggers.push(i)}},noteOff:function(t,n){for(var e=[],i=0;i<this._triggers.length;i++)this._triggers[i].noteOff(n,t)||e.push(this._triggers[i]);this._triggers=e},killAllNotes:function(){for(var t=0;t<this._triggers.length;t++)this._triggers[t].noteOff(0);this._triggers=[]}};var i=new e;t.Instrument=i,t.startPreviewNote=function(n){t.Instrument.noteOn(n,0)},t.stopPreviewNote=function(n){t.Instrument.noteOff(n,0)}}(this.Rhombus),function(t){function n(n,i,o){var s,r=240;s=0===e.notes.length?960:e.notes[e.notes.length-1].getStart()+r,e.notes.push(new t.Note(n,s,2*r)),e.notes.push(new t.Note(i,s+r,2*r)),e.notes.push(new t.Note(o,s+2*r,2*r)),e.notes.push(new t.Note(i,s+3*r,2*r))}t.Note=function(t,n,e){this._pitch=t||60,this._start=n||0,this._length=e||0},t.Note.prototype={getPitch:function(){return this._pitch},setPitch:function(){},getStart:function(){return this._start},setStart:function(){},getLength:function(){return this._length},setLength:function(){},"delete":function(){}},t._song={};var e=t._song;e.notes=new Array,n(60,63,67),n(60,63,67),n(60,63,68),n(60,63,68),n(60,63,67),n(60,63,67),n(59,62,67),n(59,62,67),t.getNoteCount=function(){return e.notes.length},t.getNote=function(t){return e.notes[t]},t.insertNote=function(){}}(this.Rhombus),function(t){function n(){var t="var scheduleId = false;\nself.onmessage = function(oEvent) {\n  if (oEvent.data.playing === false) {\n    if (scheduleId) {\n      clearTimeout(scheduleId);\n    }\n  } else {\n    triggerSchedule();\n  }\n}\nfunction triggerSchedule() {\n  postMessage(0);\n  scheduleId = setTimeout(triggerSchedule, 10);\n}\n",n=new Blob([t],{type:"application/javascript"});return new Worker(URL.createObjectURL(n))}function e(){for(var n=t._song.notes,e=t.seconds2Ticks(t.getPosition()),i=a,o=e+u,s=e+u,r=0,c=0;c<n.length;c++){var h=n[c],f=h.getStart(),l=f+h.getLength();if(f>i&&o>f){var g=t.ticks2Seconds(f)-t.getPosition();t.Instrument.noteOn(h.getPitch(),g),r+=1}if(l>i&&o>l){var g=t.ticks2Seconds(l)-t.getPosition();t.Instrument.noteOff(h.getPitch(),g),r+=1}}a=s,r>0&&console.log("scheduled ("+i+", "+o+"): "+r+" events")}function i(t){return t/h}function o(t){return t*h}function s(){a=0,t.Instrument.killAllNotes()}function r(n){return n?t._ctx.currentTime+g:g}var c=n();c.onmessage=e;var u=100,a=0,h=480,f=120;t.ticks2Seconds=function(t){return i(t)/f*60},t.seconds2Ticks=function(t){var n=t/60*f;return o(n)};var l=!1,g=0;t.startPlayback=function(){l||(l=!0,g-=t._ctx.currentTime,c.postMessage({playing:!0}))},t.stopPlayback=function(){l&&(s(),l=!1,g=r(!0),c.postMessage({playing:!1}))},t.getPosition=function(){return r(l)},t.moveToPositionTicks=function(n){var e=t.ticks2Seconds(n);t.moveToPositionSeconds(e)},t.moveToPositionSeconds=function(n){l?(s(),g=n-t._ctx.currentTime):g=n},t.getLoopEnabled=function(){},t.setLoopEnabled=function(){},t.getLoopStart=function(){},t.setLoopStart=function(){},t.getLoopEnd=function(){},t.setLoopEnd=function(){}}(this.Rhombus);