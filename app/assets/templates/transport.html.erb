<template>
	<!-- Transport bar icons made by <a href="http://appzgear.com" title="Appzgear">Appzgear</a> from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a>. Licensed under <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0">CC BY 3.0</a> -->
	<span>
		<img class="tb_button" id="rewind" src="<%= asset_path("tb_rewind.png")%>" width="50" height="50" />
		<img class="tb_button" id="play" src="<%= asset_path("tb_play.png")%>" width="50" height="50" />
		<img class="tb_button" id="pause" src="<%= asset_path("tb_pause.png")%>" width="50" height="50" style="display: none;" />
		<img class="tb_button" id="stop" src="<%= asset_path("tb_stop.png")%>" width="50" height="50" />
		<img class="tb_button" id="fastfwd" src="<%= asset_path("tb_fastforward.png")%>" width="50" height="50" />
		<img class="tb_button" id="loop" src="<%= asset_path("tb_loop.png")%>" width="50" height="50" />
		<img class="tb_button" src="<%= asset_path("tb_blank.png")%>" width="50" height="50" />
		<img class="tb_button" id="draw" src="<%= asset_path("tb_pencil.png")%>" width="50" height="50" />
		<img class="tb_button" id="select" src="<%= asset_path("tb_cursor.png")%>" width="50" height="50" />
		<img class="tb_button" src="<%= asset_path("tb_blank.png")%>" width="50" height="50" />
		<img class="tb_button tb_button_save" id="save" src="<%= asset_path("tb_save.png")%>" width="50" height="50" />
		<img class="tb_button tb_button_export" id="export" src="<%= asset_path("tb_export.png")%>" width="50" height="50" />
		<img class="tb_button tb_button_import" id="import" src="<%= asset_path("tb_import.png")%>" width="50" height="50" />
	</span>

	<style>
		.tb_button {
			-webkit-filter: invert(100%);
			position: relative;
			top: 5px;
			opacity: 0.75;
		}
		.tb_button:hover{
			opacity: 1.0;
		}
		.tb_button_save {
			position: absolute;;
			right: 0px;
<<<<<<< HEAD
			top: 10px;
=======
			top: 6px;
>>>>>>> origin/develop
		}
		.tb_button_import {
			position: absolute;;
			right: 51px;
<<<<<<< HEAD
			top: 10px;
=======
			top: 6px;
>>>>>>> origin/develop
		}
		.tb_button_export {
			position: absolute;;
			right: 102px;
<<<<<<< HEAD
			top: 10px;
=======
			top: 6px;
>>>>>>> origin/develop
		}
	</style>
</template>

<script>
	(function(){
		// get the template for this element
		var template = document.currentScript.ownerDocument.querySelector('template');

		// declare persistent buttons
		var rewind, play, pause, stop, fastforward, loop, draw, select, exp, imp, save;

		// copy a prototype from HTMLElement
		var transportbarPrototype = Object.create(HTMLElement.prototype);

		var playing = false;

		// specify the created callback ("constructor")
		transportbarPrototype.createdCallback = function(){
			var root = this.createShadowRoot();
			root.appendChild(document.importNode(template.content, true));

			// get references to the transport bar's buttons
			rewind = root.querySelector('#rewind');
			play = root.querySelector('#play');
			pause = root.querySelector('#pause');
			stop = root.querySelector('#stop');
			fastfwd = root.querySelector('#fastfwd');
			loop = root.querySelector('#loop');
			draw = root.querySelector('#draw');
			select = root.querySelector('#select');
			save = root.querySelector('#save');
			exp = root.querySelector('#export');
			imp = root.querySelector('#import');

			// make the buttons react when clicked on
			rewind.addEventListener('mouseup', 
				function(){
					var keyEvent = new CustomEvent("denoto-rewind", {"detail": "rewind"});
					root.host.dispatchEvent(keyEvent);
				});

			play.addEventListener('mouseup', 
				function(){ 
					var keyEvent = new CustomEvent("denoto-play", {"detail": "play"}); 
					root.host.dispatchEvent(keyEvent);
					
					if(!playing) {
						playing = true;
						pause.setAttribute('style', "");
						play.setAttribute('style', "display: none;");
					}
				});

			pause.addEventListener('mouseup', 
				function(){
					var keyEvent = new CustomEvent("denoto-pause", {"detail": "pause"}); 
					root.host.dispatchEvent(keyEvent);
					
					if (playing) {
						playing = false;
						pause.setAttribute('style', "display: none;");
						play.setAttribute('style', "");
					}
				});

			stop.addEventListener('mouseup', 
				function(){
					var keyEvent = new CustomEvent("denoto-stop", {"detail": "stop"});
					root.host.dispatchEvent(keyEvent); 
					if (playing) {
						playing = false;
						pause.setAttribute('style', "display: none;");
						play.setAttribute('style', "");
					}
				});
			fastfwd.addEventListener('mouseup', function(){ var keyEvent = new CustomEvent("denoto-fastfwd", {"detail": "fastfwd"}); root.host.dispatchEvent(keyEvent); });

			loop.addEventListener('mouseup', 
				function(){
					var keyEvent = new CustomEvent("denoto-loopToggle", {"detail": "loop"});
					root.host.dispatchEvent(keyEvent); 
				});

			draw.addEventListener('mouseup', 
				function(){
					var keyEvent = new CustomEvent("denoto-drawmode", {"detail": "draw"});
					// dispatch to the document because the pianoroll needs to hear this
					document.dispatchEvent(keyEvent);
				});

			select.addEventListener('mouseup', 
				function(){
					var keyEvent = new CustomEvent("denoto-selectmode", {"detail": "select"});
					// dispatch to the document because the pianoroll needs to hear this
					document.dispatchEvent(keyEvent);
				});

			exp.addEventListener('mouseup', 
				function(){
					var keyEvent = new CustomEvent("denoto-export", {"detail": "export"});
					root.host.dispatchEvent(keyEvent); 
				});

			imp.addEventListener('mouseup', 
				function(){
					var keyEvent = new CustomEvent("denoto-import", {"detail": "import"});
					root.host.dispatchEvent(keyEvent);
				});

			save.addEventListener('mouseup', 
				function(){
					var keyEvent = new CustomEvent("denoto-save", {"detail": "save"});
					root.host.dispatchEvent(keyEvent);
				});
		};

		// register the element
		var transportbar = document.registerElement('denoto-transportbar', {prototype: transportbarPrototype});
	})();
</script>