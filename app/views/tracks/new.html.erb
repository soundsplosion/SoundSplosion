<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<link rel="import" href="/assets/keyboard.html">
<link rel="import" href="/assets/blackkey.html">
<link rel="import" href="/assets/whitekey.html">
<link rel="import" href="/assets/pianoroll.html">
<link rel="import" href="/assets/transport.html">
<link rel="import" href="/assets/countdown.html">
<link rel="stylesheet" href="/assets/trackinterface.css">
</head>

<div id="top-bar">
  <denoto-transportbar id="transportbar"></denoto-transportbar>
  <denoto-countdown id="countdowntimer"></denoto-countdown>
</div>
<div id="midi-interface">
  <denoto-keyboard id="appkeyboard" keycount="24"></denoto-keyboard>
  <denoto-pianoroll id="apppianoroll"></denoto-pianoroll>
<div>

Data to be uploaded to server 
<div><%= text_area_tag :track_data %></div>
<%= render 'form' %>
<%= link_to 'Back', tracks_path %>

<script>
  function uploadFile(){
    $.ajax({
    type:'GET',
    url:'/upload/new',
    data: { track_data: document.getElementById("track_data").value, track_title: document.getElementById("track_title").value}
    });
  }
</script>

<script>
  // keyboard events
  document.getElementById("appkeyboard").addEventListener("denoto-keydown", function(e){ console.log("[Keyboard] Key " + e.detail.keyvalue + " down") });
  document.getElementById("appkeyboard").addEventListener("denoto-keyup", function(e){ console.log("[Keyboard] Key " + e.detail.keyvalue + " up") });
  
  // piano roll events
  document.getElementById("apppianoroll").addEventListener("denoto-writenote", function(e){ console.log("[PianoRoll] Writing note! measure: " + e.detail.measure + ", beat: " + e.detail.beat + ", duration: " + e.detail.duration + ", value: " + e.detail.keyvalue); });
  document.getElementById("apppianoroll").addEventListener("denoto-erasenote", function(e){ console.log("[PianoRoll] Erasing note! measure: " + e.detail.measure + ", beat: " + e.detail.beat + ", duration: " + e.detail.duration + ", value: " + e.detail.keyvalue); });

  // transport bar events
  document.getElementById("transportbar").addEventListener("denoto-rewind", function(e){ console.log("[TransportBar] Rewind pressed") });
  document.getElementById("transportbar").addEventListener("denoto-play", function(e){ console.log("[TransportBar] Play pressed") });
  document.getElementById("transportbar").addEventListener("denoto-pause", function(e){ console.log("[TransportBar] Pause pressed") });
  document.getElementById("transportbar").addEventListener("denoto-stop", function(e){ console.log("[TransportBar] Stop pressed") });
  document.getElementById("transportbar").addEventListener("denoto-fastfwd", function(e){ console.log("[TransportBar] Fastfwd pressed") });
  
  // countdown timer events
  document.getElementById("countdowntimer").addEventListener("denoto-endcountdown", function(e){ console.log("[CountdownTimer] Out of time!") });
</script>